<!DOCTYPE html>
<html>
  <head>
    <!-- Standard Meta -->
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <title>نظرسنجی ۲۰۱۶ - پژوهشکده علوم‌شناختی دانشگاه شهید بهشتی</title>

    <link rel="stylesheet" href="assets/css/semantic.rtl.css">
    <link rel="stylesheet" href="assets/css/main.css">

    <script src="assets/js/jquery.min.js"></script>
    <script src="assets/js/semantic.min.js"></script>
    <script src="assets/js/cookie.js"></script>
  </head>

<body>

<div class="ui text segment container">
  <form class="ui fluid form" id="qform" onsubmit="return false;" role="form" method="POST" action="" enctype="multipart/form-data">
    <input type="hidden" name="assignmentId" value="0" />
  <div id="common-questions">
    <div class="two fields">
      <div class="field">
        <label>جنسیتِ شما</label>
        <select class="ui dropdown" name="q1">
          <option value="male">مرد</option>
          <option value="female">زن</option>
          <option value="-">علاقه‌ای به اعلام ندارم</option>
        </select>
      </div>

      <div class="field">
        <label>سنِ شما</label>
        <input type="number" value="" name="q2" min="1" />
      </div>
      <div class="field">
        <label>وضعیت اقتصادیِ شما</label>
        <select class="ui dropdown" name="q3">
          <option value="5">بالا</option>
          <option value="4">متوسط رو به بالا</option>
          <option value="3">متوسط</option>
          <option value="2">متوسط رو به پایین</option>
          <option value="1">پایین</option>
          <option value="0">علاقه‌ای به اعلام ندارم</option>
        </select>
      </div>
    </div>

    <div class="three fields">
      <div class="field">
        <label>آیا تصویر زیر نشان‌دهندهٔ کودکی ۴ تا ۶ سال است؟</label>
        <select class="ui dropdown" name="q4">
          <option value="yes">بلی</option>
          <option value="no">خیر</option>
          <option value="-">مشخص نیست</option>
        </select>
      </div>
    </div>

    <div class="ui hidden divider"></div>
    <div class="ui divider"></div>
  </div> <!-- /.common-questions -->
    <div class="ui hidden divider"></div>

    <div class="ui top aligned center aligned two column stackable grid" id="content">
      <div class="column">
        <img class="ui centered large survey bordered image" src="" id="qimage">
      </div>
      <div class="top column">
        <div class="ui blue header">لطفن براساس تصاویر ارائه‌شده به پرسش‌ها پاسخ دهید.</div>
        <div class="ui small info message">
        نمرهٔ ۱ کمترین، و نمرهٔ ۶ بالاترین نمره است.
        </div>
        <label id="question-label">سوال</label>
        <div class="ui hidden divider"></div>
        <div class="ui centered inline fields">
          <div class="ui field" id="q4">
            <div class="ui radio checkbox">
              <input type="radio" name="q5" value="1" defaultValue="1" />
              <label>۱</label>
            </div>
          </div>
          <div class="ui field">
            <div class="ui radio checkbox">
              <input type="radio" name="q5" value="2" defaultValue="2" />
              <label>۲</label>
            </div>
          </div>
          <div class="ui field">
            <div class="ui radio checkbox">
              <input type="radio" name="q5" value="3" defaultValue="3" />
              <label>۳</label>
            </div>
          </div>
          <div class="ui field">
            <div class="ui radio checkbox">
              <input type="radio" name="q5" value="4" defaultValue="4" />
              <label>۴</label>
            </div>
          </div>
          <div class="ui field">
            <div class="ui radio checkbox">
              <input type="radio" name="q5" value="5" defaultValue="5" />
              <label>۵</label>
            </div>
          </div>
          <div class="ui field">
            <div class="ui radio checkbox">
              <input type="radio" name="q5" value="6" defaultValue="6" />
              <label>۶</label>
            </div>
          </div>
        </div>
          <div class="ui field">
            <input type="submit" class="ui compact primary submit button" value="تصویر بعدی" id="save-btn"/>
          </div>
      </div>
    </div>
  </form> <!--/.form-->
</div>
    <!-- Consent Modal -->
    <div class="ui small consent modal">
      <div class="content">
      شرکت‌کنندهٔ گرامی
      <div class="ui hidden divider"></div>
      با تشکر از این‌که در پژوهش حاضر شرکت کرده‌اید، در ادامه تصاویری را مشاهده می­کنید که لازم است به پرسش‌های مرتبط با هر تصویر پاسخ دهید.
      <div class="ui divider"></div>
      تعدادی <strong>کلمات کلیدی</strong> در پرسش‌های مطرح‌شده وجود دارد که تعاریف هر یک در زیر آورده شده است:<br /><br />

      &mdash; <strong>کودک بیمار یا ناتوان</strong>: کودکی که از چهره یا حالات بدنی‌اش مشخص است که به بیماری یا نقص جسمانی خاصی مبتلا است.<br />

      &mdash; <strong>کودک فقیر یا بی‌خانمان</strong>: کودکی که از حالات ظاهری یا موقعیتی که در آن قرار دارد، مشخص است که فقیر، کم‌پول یا بی‌خانمان است.<br />

      &mdash; <strong>کودک پول‌دار</strong>: کودکی که از وضعیت ظاهری یا موقعیتی که در آن است مشخص است که پول‌دار و مرفه است.<br />

      &mdash; <strong>کودک معمولی</strong>: کودکی که هیچ یک از ویژگی‌های کودکان گروه‌های دیگر را نداشته باشد کودک معمولی نامیده می‌شود.<br />

      <div class="ui divider"></div>
      لطفاً با دقت به هر تصویر نگاه کنید و بهترین پاسخ ممکن را انتخاب کنید. برای ادامه کلیک کنید.
      </div>
      <div class="actions">
        <a href="#" class="ui primary approve icon right labeled button">
          موافقم و ادامه
          <i class="left arrow icon"></i>
        </a>
    </div>
    </div> <!--/.modal -->

    <script>
    $("select.dropdown").dropdown();
    $('#qform').form();
    </script>
    <script>
      var questions = [
        "آیا این تصویر نشان‌دهندهٔ کودکی بیمار یا ناتوان است؟",
        "آیا این تصویر نشان‌دهندهٔ کودکی از طبقه متوسط جامعه (معمولی) است؟",
        "آیا این تصویر نشان‌دهندهٔ کودکی فقیر یا بی‌خانمان است؟",
        "آیا این تصویر نشان‌دهندهٔ کودکی مرفه و پول‌دار است؟"
      ];

      function getRandomGroup (total) {
        var randomGroup = Math.floor((Math.random() * total) + 1);
        return randomGroup;
      }
      // groupCount is the number of images in each group (8 groups)
      function getRandomImageRelativePath (group, numOfImages) {
        var genders = ["boys", "girls"];
        var gendersShort = ["b", "g"];
        var groups = ["disabled","ordinary","poor","wealthy"];
        var groupsShort = ["dis","ord","p","weal"];

        var groupRandom = group;//Math.floor((Math.random() * 4));
        var genderRandom = Math.floor((Math.random() * 2));
        var childRandom =  Math.floor((Math.random() * numOfImages) + 1);
        return "data/images/children/" + groups[groupRandom] + "/" + genders[genderRandom] + "/" + childRandom + "_" + groupsShort[groupRandom] + "_" + gendersShort[genderRandom] + '.jpg';
      };
      $(document).ready(function(){
        $.ajax({
          url: "https://cut.social/scm2016/uuid",
          success: function(data){
            var uuid = Cookies.get('scm2016_uuid');
            if(typeof uuid === "undefined"){
              Cookies.set('scm2016_uuid', data);
              uuid = Cookies.get('scm2016_uuid');
              $('.ui.small.consent.modal').modal({
                closable:false
              }).modal('show');
            } else {
              $("#common-questions").remove();
            }
            $("input[name='assignmentId']").val(""+uuid);
            $("input[name='assignmentId']").attr("value",""+uuid);
          }
        });
        var group = getRandomGroup(4);
        var imagePath = getRandomImageRelativePath(group, 30);

        // Update question
        $("#question-label").html(questions[group]);
        // Update Image
        $("#qimage").attr('src', imagePath);
      });
      $("#save-btn").click(function(evt){
        var formData = JSON.stringify($("#qform").serializeArray());
        //alert("نتیجه زیر ثبت شد. با تشکر.\n" + formData);
        $.ajax({
          type: "POST",
          url: "https://cut.social/scm2016/save",
          data: formData,
          dataType: "json",
          contentType: "multipart/form-data;charset=UTF-8"
        }).done(function() {
          $('.ui.compact.primary.submit.button').hide();
          //TODO check if experiment is finished!
          location.reload();
        }).fail(function(xhr, status, error) {
          $('.ui.compact.primary.submit.button').hide();
          alert("خطایی در ارتباط با سرور رخ داده است. لطفاً صفحه را رِفرِش کنید یا در آینده نزدیک دوباره مراجعه کنید.");
        });
        evt.preventDefault();
        $('.ui.compact.primary.submit.button').hide();
      });
    </script>
    <!--
    <script type="text/babel" src="./js/app.js"></script>
  -->
<!--
    <h1>Hello World!</h1>
    We are using node <script>document.write(process.versions.node)</script>,
    Chrome <script>document.write(process.versions.chrome)</script>,
    and Electron <script>document.write(process.versions.electron)</script>.
-->
  </body>
</html>
